"use strict";angular.module("mkm.flickr",["API","ngMaterial"]).service("restAPI",["$http","$api",function($http,$api){function _getPhotoset(setid){return $http.jsonp("https://api.flickr.com/services/rest/",{cache:!1,params:{jsoncallback:"JSON_CALLBACK",method:"flickr.photosets.getPhotos",api_key:apiKey,photoset_id:setid,extras:"description",format:"json"}})}function _getRecent(userid){return $http.jsonp("https://api.flickr.com/services/rest/",{cache:!1,params:{jsoncallback:"JSON_CALLBACK",method:"flickr.people.getPhotos",user_id:userid,api_key:apiKey,extras:"o_dims,description",format:"json",per_page:500}})}function _getImg(imgid){return $http.jsonp("https://api.flickr.com/services/rest/",{cache:!1,params:{jsoncallback:"JSON_CALLBACK",method:"flickr.photos.getInfo",api_key:apiKey,photo_id:imgid,format:"json"}})}var apiKey=$api.flickr;return{getPhotoset:_getPhotoset,getRecent:_getRecent,getImg:_getImg}}]).controller("mainCtrlr",["",function(){}]),angular.module("mkm.flickr").directive("flickrAlbum",["restAPI","$mdPanel",function($flickr,$mdPanel){function link(scope){function photoDetailCtrl($scope,mdPanelRef,photoDetail,detailIndex,photos){function photoDetailSet(ind){$scope.photoDetail=$scope.photos[ind]}$scope._mdPanelRef=mdPanelRef,$scope.photoDetail=photoDetail,$scope.detailIndex=detailIndex,$scope.photos=photos,$scope.detailClose=function(){this._mdPanelRef.close().then(function(){angular.element(document.querySelector(".recent-tile")).focus()})},$scope.detailNext=function(){$scope.detailIndex++,photoDetailSet($scope.detailIndex)},$scope.detailPrev=function(){$scope.detailIndex--,photoDetailSet($scope.detailIndex)}}scope.detailPanel=$mdPanel;var galleryID=scope.albumId,galleryData=new $flickr.getPhotoset(galleryID);galleryData.then(function(data){scope.gallery=data.data}),scope.photoDetail=null,scope.photoDetailIndx=null,scope.thumbClick=function($event,img,ind){scope.photoDetail=img;var position=this.detailPanel.newPanelPosition().absolute().center();this.detailPanel.open({attachTo:angular.element(document.body),controller:photoDetailCtrl,controllerAs:"ctrl",disableParentScroll:!0,templateUrl:"flickr/flickr-photo-detail.html",hasBackdrop:!0,panelClass:"flickr-photo-detail",position:position,trapFocus:!0,zIndex:150,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,targetEvent:$event,locals:{photoDetail:scope.photoDetail,detailIndex:ind,photos:scope.gallery.photoset.photo}})}}return{templateUrl:"flickr/flickr-album.html",scope:{albumId:"=albumId"},link:link}}]),angular.module("mkm.flickr").directive("flickrImg",[function(){return{templateUrl:function(element){return element.attr("new-view")||"flickr/flickr-img.html"},restrict:"E",link:function(scope){scope.size="b",window.onresize=function(){scope.$digest()}},scope:{img:"=info"}}}]),angular.module("mkm.flickr").directive("recentPhotos",["restAPI","$mdPanel",function($flickr,$mdPanel){function link(scope){function photoDetailCtrl($scope,mdPanelRef,photoDetail,detailIndex,photos){function photoDetailSet(ind){$scope.photoDetail=$scope.photos[ind]}$scope._mdPanelRef=mdPanelRef,$scope.photoDetail=photoDetail,$scope.detailIndex=detailIndex,$scope.photos=photos,$scope.detailClose=function(){this._mdPanelRef.close().then(function(){angular.element(document.querySelector(".recent-tile")).focus()})},$scope.detailNext=function(){$scope.detailIndex++,photoDetailSet($scope.detailIndex)},$scope.detailPrev=function(){$scope.detailIndex--,photoDetailSet($scope.detailIndex)}}scope.detailPanel=$mdPanel,scope.detailIndex=null,scope.photoDetail=null,scope.thumbnailsShow=[],scope.recent=[],scope.photoStep=scope.photoStep||5,scope.photoCount=scope.countInit-scope.photoStep||0;var photoData=new $flickr.getRecent(scope.flickrID);photoData.then(function(data){scope.recent=data.data.photos.photo,scope.thumbnailsAdd()}),scope.thumbnailsAdd=function(){scope.photoCount+=scope.photoStep,scope.thumbnailsShow=scope.recent.slice(0,scope.photoCount)},scope.thumbnailClick=function($event,img,ind){scope.photoDetail=img;var position=this.detailPanel.newPanelPosition().absolute().center();this.detailPanel.open({attachTo:angular.element(document.body),controller:photoDetailCtrl,controllerAs:"ctrl",disableParentScroll:!0,templateUrl:"flickr/flickr-photo-detail.html",hasBackdrop:!0,panelClass:"flickr-photo-detail",position:position,trapFocus:!0,zIndex:150,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,targetEvent:$event,locals:{photoDetail:scope.photoDetail,detailIndex:ind,photos:scope.thumbnailsShow}})}}return{link:link,templateUrl:function(element){return element.attr("new-view")||"flickr/flickr-recent.html"},restrict:"E",scope:{flickrID:"=flickrId",countInit:"=count",step:"=step"}}}]);